# Physische Karte mit farbigen Höhenklassen, Überhöhung, Wald/Stadt und sichtbarem Wasser
global:
  bg: [1.0, 1.0, 1.0, 1.0]

  # Farben (kannst du im UI überschreiben, falls du den Konfigurator nutzt)
  water_fill: [0.38, 0.69, 1.0, 1.0]
  water_line: [0.41, 0.71, 1.0, 1.0]
  forest_fill: [0.06, 0.25, 0.12, 1.0]
  urban_fill:  [0.25, 0.27, 0.30, 0.9]

  # Farben der Höhenklassen
  elev_0:    [0.85, 0.92, 0.83, 1.0]   # <200 m
  elev_200:  [0.80, 0.87, 0.78, 1.0]   # 200–600 m
  elev_600:  [0.76, 0.74, 0.66, 1.0]   # 600–1000 m
  elev_1000: [0.68, 0.63, 0.55, 1.0]   # 1000–1500 m
  elev_1500: [0.78, 0.78, 0.78, 1.0]   # 1500–2500 m
  elev_2500: [0.95, 0.95, 0.95, 1.0]   # >2500 m

  # Überhöhungs-Faktor (1.0 = normal, größer = stärker)
  exaggeration: 1.8

sources:
  hillshade:
    type: Raster
    url: https://api.maptiler.com/tiles/hillshade/{z}/{x}/{y}.png?key=582YgxGFbrCVlE8xVsbq
    tile_size: 512
    max_zoom: 15

  terrain-rgb:
    type: Raster
    url: https://api.maptiler.com/tiles/terrain-rgb/{z}/{x}/{y}.png?key=582YgxGFbrCVlE8xVsbq
    tile_size: 512
    max_zoom: 14

  vect:
    type: MVT
    url: https://api.maptiler.com/tiles/v3/{z}/{x}/{y}.mvt?key=582YgxGFbrCVlE8xVsbq
    tile_size: 512
    max_zoom: 14

styles:
  # leicht aufgehelltes Basis-Hillshade
  base_hillshade:
    base: raster
    shaders:
      blocks:
        color: |
          float g = color.r;
          g = mix(0.94, 0.65, g);
          color = vec4(vec3(g), 1.0);

  # farbige Höhenklassen mit Überhöhung
  terrain_colors:
    base: raster
    blend: overlay
    shaders:
      uniforms:
        ex:       global.exaggeration
        elev0:    global.elev_0
        elev200:  global.elev_200
        elev600:  global.elev_600
        elev1000: global.elev_1000
        elev1500: global.elev_1500
        elev2500: global.elev_2500
      blocks:
        color: |
          // Terrain-RGB -> Höhe in Metern
          float r = color.r * 255.0;
          float g = color.g * 255.0;
          float b = color.b * 255.0;
          float h = -10000.0 + ((r * 256.0 * 256.0 + g * 256.0 + b) * 0.1);
          h = h * ex; // Überhöhung

          vec4 c;
          if (h < 200.0)       c = elev0;
          else if (h < 600.0)  c = elev200;
          else if (h < 1000.0) c = elev600;
          else if (h < 1500.0) c = elev1000;
          else if (h < 2500.0) c = elev1500;
          else                 c = elev2500;
          color = c;

  water-poly:  { base: polygons }
  water-line:  { base: lines }
  forest-poly: { base: polygons }
  urban-poly:  { base: polygons }

scene:
  background:
    color: global.bg

layers:
  # 0 – Basis
  hill:
    data: { source: hillshade }
    draw:
      base_hillshade:
        order: 0
        raster: true

  # 1 – farbige Höhenklassen
  elevation_colors:
    data: { source: terrain-rgb }
    draw:
      terrain_colors:
        order: 1
        raster: true

  # 7 – Wälder
  forests:
    data: { source: vect, layer: landcover }
    filter: { class: [wood, forest], $zoom: { min: 5 } }
    draw:
      forest-poly:
        order: 7
        color: global.forest_fill

  # 8 – Siedlungsflächen
  urban_landuse:
    data: { source: vect, layer: landuse }
    filter: { class: [residential, commercial, industrial], $zoom: { min: 6 } }
    draw:
      urban-poly:
        order: 8
        color: global.urban_fill

  urban_landcover:
    data: { source: vect, layer: landcover }
    filter: { class: [urban], $zoom: { min: 6 } }
    draw:
      urban-poly:
        order: 8
        color: global.urban_fill

  # 10/11 – Wasser ganz oben
  water_areas:
    data: { source: vect, layer: water }
    draw:
      water-poly:
        order: 10
        color: global.water_fill

  waterways:
    data: { source: vect, layer: waterway }
    filter: { $zoom: { min: 5 } }
    draw:
      water-line:
        order: 11
        color: global.water_line
        width: [[5, 0.4px], [8, 0.7px], [12, 1.3px], [16, 2.0px]]
